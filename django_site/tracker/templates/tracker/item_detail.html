{% extends "tracker/base.html" %}
{% block title %}{{ item.name }} â€” TF Tracker{% endblock %}
{% block content %}
<div class="actions">
  <a href="{% url 'tracker:item-list' %}" class="btn secondary">Back</a>
  <a href="{% url 'tracker:item-edit' item.pk %}" class="btn">Edit</a>
</div>

<h2>{{ item.name }}</h2>
<div class="detail-grid">
  <div><strong>Company:</strong> {{ item.company.name|default_if_none:"" }}</div>
  <div><strong>Line:</strong> {{ item.line.name|default_if_none:"" }}</div>
  <div><strong>Series:</strong> {{ item.series.name|default_if_none:"" }}</div>
  <div><strong>SKU:</strong> {{ item.sku|default_if_none:"" }}</div>
  <div><strong>Version:</strong> {{ item.version|default_if_none:"" }}</div>
  <div><strong>Year:</strong> {{ item.year|default_if_none:"" }}</div>
  <div><strong>Scale:</strong> {{ item.scale|default_if_none:"" }}</div>
  <div><strong>Condition:</strong> {{ item.condition|default_if_none:"" }}</div>
  <div><strong>Status:</strong> {{ item.status|default_if_none:"" }}</div>
  <div><strong>Location:</strong> {{ item.location|default_if_none:"" }}</div>
  <div><strong>URL:</strong>
    {% if item.url %}
      <a href="{{ item.url }}" target="_blank" rel="noopener">Link</a>
    {% endif %}
  </div>
  <div><strong>Type:</strong> {{ item.type.name|default_if_none:"" }}</div>
  <div><strong>Category:</strong> {{ item.category.name|default_if_none:"" }}</div>
  <div><strong>Factions:</strong>
    {% if factions %}
      {{ factions|join:", " }}
    {% else %}
      <em>None</em>
    {% endif %}
  </div>
  <div><strong>Teams:</strong>
    {% if teams %}
      {{ teams|join:", " }}
    {% else %}
      <em>None</em>
    {% endif %}
  </div>

  <div class="full">
    <strong>Characters:</strong>
    {% if characters %}
      <ul>
      {% for character in characters %}
        <li>
          {{ character.name }}
          {% if character.role %}
            <em>({{ character.role }})</em>
          {% endif %}
          {% if character.is_primary %}
            <strong>(Primary)</strong>
          {% endif %}
        </li>
      {% endfor %}
      </ul>
    {% else %}
      <em>None</em>
    {% endif %}
  </div>
  <div class="full">
    <strong>Purchases:</strong>
    {% if purchases %}
      <div class="table-wrapper">
        <table class="detail-table">
          <thead>
            <tr>
              <th>Vendor</th>
              <th>Order #</th>
              <th>Order Date</th>
              <th>Purchase Date</th>
              <th>Ship Date</th>
              <th>Price</th>
              <th>Qty</th>
              <th>Tax</th>
              <th>Shipping</th>
              <th>Line Total</th>
              <th>Currency</th>
              <th>Collection</th>
              <th>Owner</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody>
            {% for purchase in purchases %}
              <tr>
                <td>{{ purchase.vendor|default_if_none:"" }}</td>
                <td>{{ purchase.order_number|default_if_none:"" }}</td>
                <td>{{ purchase.order_date|date:"Y-m-d"|default_if_none:"" }}</td>
                <td>{{ purchase.purchase_date|date:"Y-m-d"|default_if_none:"" }}</td>
                <td>{{ purchase.ship_date|date:"Y-m-d"|default_if_none:"" }}</td>
                <td>
                  {% if purchase.price is not None %}
                    {{ purchase.price|floatformat:2 }}
                  {% endif %}
                </td>
                <td>{{ purchase.quantity }}</td>
                <td>
                  {% if purchase.tax is not None %}
                    {{ purchase.tax|floatformat:2 }}
                  {% endif %}
                </td>
                <td>
                  {% if purchase.shipping is not None %}
                    {{ purchase.shipping|floatformat:2 }}
                  {% endif %}
                </td>
                <td>
                  {% if purchase.total is not None %}
                    {{ purchase.total|floatformat:2 }}
                  {% endif %}
                </td>
                <td>{{ purchase.currency|default_if_none:"" }}</td>
                <td>{{ purchase.collection|default_if_none:"" }}</td>
                <td>{{ purchase.owner|default_if_none:"" }}</td>
                <td>{{ purchase.notes|default_if_none:"" }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <em>None</em>
    {% endif %}
  </div>
  <div class="full"><strong>Notes:</strong> {{ item.notes|default_if_none:"" }}</div>
</div>

<form method="post" action="{% url 'tracker:item-delete' item.pk %}" onsubmit="return confirm('Delete this item?');">
  {% csrf_token %}
  <button class="btn danger" type="submit">Delete</button>
</form>
{% endblock %}
